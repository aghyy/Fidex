generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  firstName      String?
  lastName       String?
  username       String?         @unique
  email          String          @unique
  createdAt      DateTime        @default(now())
  emailVerified  DateTime?
  image          String?
  password       String?
  theme          ThemePreference @default(SYSTEM)
  updatedAt      DateTime        @default(now()) @updatedAt
  accounts       OAuthAccount[]
  sessions       Session[]
  authenticators Authenticator[]
  categories     Category[]
  Document       Document[]
  Account        Account[]
}

model OAuthAccount {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @default(now()) @updatedAt
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
}

model Session {
  sessionToken String   @unique
  userId       String
  expires      DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @default(now()) @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@index([token])
}

model EmailVerificationToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@index([email])
  @@index([token])
}

model Authenticator {
  credentialID         String   @unique
  userId               String
  providerAccountId    String
  credentialPublicKey  String
  counter              Int
  credentialDeviceType String
  credentialBackedUp   Boolean
  transports           String?
  name                 String?
  createdAt            DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, credentialID])
}

model Transaction {
  id              String              @id @default(cuid())
  userId          String
  originAccountId String
  targetAccountId String
  amount          BigInt
  notes           String
  interval        TransactionInterval @default(ONCE)
  type            TransactionType     @default(EXPENSE)
  category        String
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @default(now()) @updatedAt
  expires         DateTime
}

model Category {
  id        String   @id @default(cuid())
  userId    String
  name      String
  color     String?
  icon      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name])
}

model Document {
  id         String   @id @default(cuid())
  userId     String
  categoryId String
  name       String
  content    String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name, categoryId])
}

model Account {
  id            String   @id @default(cuid())
  userId        String
  name          String
  accountNumber String
  color         String
  icon          String
  balance       BigInt
  currency      Currency
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now()) @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name, accountNumber])
}

// Enums

enum ThemePreference {
  LIGHT
  DARK
  SYSTEM
}

enum TransactionInterval {
  ONCE
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum TransactionType {
  EXPENSE
  INCOME
  TRANSFER
}

enum Currency {
  USD
  EUR
  GBP
  CHF
  JPY
  CAD
  AUD
  NZD
  CNY
  HKD
  SGD
  KRW
  INR
  RUB
  BRL
  MXN
  ZAR
  TRY
  SAR
  AED
  ALL
  BGN
  CZK
  DKK
  HUF
  ISK
  NOK
  PLN
  RON
  RSD
  SEK
  UAH
  ARS
  BSD
  BBD
  BZD
  BMD
  BOB
  CLP
  COP
  CRC
  CUP
  DOP
  GTQ
  HTG
  HNL
  JMD
  NIO
  PAB
  PYG
  PEN
  TTD
  UYU
  VES
  DZD
  AOA
  BWP
  CVE
  EGP
  ETB
  GHS
  KES
  LYD
  MAD
  MZN
  NAD
  NGN
  RWF
  SCR
  TZS
  TND
  UGX
  XOF
  XAF
  ZMW
  ZWL
  AFN
  AMD
  AZN
  BHD
  BDT
  BTN
  BND
  KHR
  GEL
  IDR
  IRR
  IQD
  ILS
  JOD
  KZT
  KWD
  KGS
  LAK
  LBP
  MYR
  MVR
  MNT
  NPR
  OMR
  PKR
  PHP
  QAR
  LKR
  SYP
  TJS
  THB
  TMT
  UZS
  VND
  YER
  FJD
  PGK
  WST
  SBD
  TOP
  VUV
}
